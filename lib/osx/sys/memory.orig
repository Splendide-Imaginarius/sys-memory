require 'fiddle'
require 'fiddle/import'

module Sys
  module Memory
    extend Fiddle::Importer
    dlload('libc.dylib')
    extern 'int sysctlbyname(const char*, void*, size_t*, void*, size_t)'

    def memory
      ptr = 0.chr * 16
      sysctlbyname('hw.memsize', ptr, ptr.size, nil, 0)
      ptr.strip
    end

    module_function :memory
  end
end

p Sys::Memory.memory
